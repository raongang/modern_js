<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="utf-8" />
    <title></title>      

<script>
    
    /* 15.8.7 Promise로 비동기 연결처리하기
       - then메소드안에서 실행하는 성공콜백 함수가 promise 객체를 반환하도록 하여 체인으로 연결.
    */
    
    window.onload = function(){     
        
        function buyAsync(mymoney){
            return new Promise(function(resolve,reject){
               setTimeout(function(){
                   var payment= parseInt(prompt("Input pay money..."));
                    var balance = mymoney - payment;
                   
                    if(balance>0){
                        console.log(`${payment}원을 지불했습니다.`);
                        resolve(balance);
                    }else{
                        reject(`잔액은 ${mymoney}원입니다. 구매할 수 없습니다.`);
                    }                   
               },1000);
            });
        }
        
        buyAsync(500)
        .then(function(balance){
            console.log(`잔액은 ${balance}원입니다.`);
            return buyAsync(balance);
        }).then(function(balance){
            console.log(`잔액은 ${balance}원입니다.`);
            return buyAsync(balance);
        }).then(function(balance){
            console.log(`잔액은 ${balance}원입니다.`);          
        }).catch(function(error){
            console.log(error);     
        });

        
    };//end window.

  
</script>  
</head>
<body>
    
</body>
</html>






    